(()=>{var _=(()=>{let r=null,u=null,y=0,d=0,p=!0,l=()=>{y+=1},m=()=>`(${d}/${y}) [${parseInt(d/y*100).toFixed(0)}%]`;return{init:()=>{r=document.getElementById("progress-info"),u=document.getElementById("progress-bar"),r.style.display="block"},add:l,invalid:S=>{p=!1,u.style.backgroundColor="red",r.innerText=`Error loading ${S} ${m()}`},complete:S=>{p&&(d+=1,r.innerText=`Loading ${S} complete ${m()}`,u.style.width=Math.min(d/y*100,100).toString()+"%",d===y&&document.dispatchEvent(new Event("progress.done")))}}})();var v=(()=>{let r='<span class="spinner-border spinner-border-sm my-0 ms-0 me-1 p-0" style="height: 0.8rem; width: 0.8rem;"></span>',u=o=>String(o).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"),y=(o,f,i=.05)=>new Promise(b=>{let E=parseFloat(o.style.opacity),x=f?1:0,w=()=>{E+=f?i:-i,E=Math.max(0,Math.min(1,E)),o.style.opacity=E.toFixed(2),f&&E>=x||!f&&E<=x?(o.style.opacity=x.toString(),b(o)):requestAnimationFrame(w)};requestAnimationFrame(w)}),d=(o,f)=>{let i=null;i=setTimeout(()=>{o(),clearTimeout(i),i=null},f)};return{loader:r,copy:async(o,f=null,i=1500)=>{let b=o.getAttribute("data-copy");if(!b||b.length===0){alert("Nothing to copy");return}o.disabled=!0;try{await navigator.clipboard.writeText(b)}catch{o.disabled=!1,alert("Failed to copy");return}let E=o.innerHTML;o.innerHTML=f||'<i class="fa-solid fa-check"></i>',d(()=>{o.disabled=!1,o.innerHTML=E},i)},timeOut:d,debounce:(o,f)=>{let i=null;return(...b)=>{clearTimeout(i),i=setTimeout(()=>o(...b),f)}},escapeHtml:u,base64Encode:o=>{let i=new TextEncoder().encode(o);return window.btoa(String.fromCharCode(...i))},base64Decode:o=>{let f=new TextDecoder,i=Uint8Array.from(window.atob(o),b=>b.charCodeAt(0));return f.decode(i)},disableButton:(o,f="Loading")=>{o.disabled=!0;let i=o.innerHTML;return o.innerHTML=r+f,{restore:()=>{o.innerHTML=i,o.disabled=!1}}},disableCheckbox:o=>{o.disabled=!0;let f=document.querySelector(`label[for="${o.id}"]`),i=f.innerHTML;return f.innerHTML=r+i,{restore:()=>{f.innerHTML=i,o.disabled=!1}}},parseUserAgent:o=>{let f=[{type:"Mobile",regex:/Android.*Mobile|iPhone|iPod|BlackBerry|IEMobile|Opera Mini/i},{type:"Tablet",regex:/iPad|Android(?!.*Mobile)|Tablet/i},{type:"Desktop",regex:/Windows NT|Macintosh|Linux/i}],i=[{name:"Chrome",regex:/Chrome|CriOS/i},{name:"Safari",regex:/Safari/i},{name:"Edge",regex:/Edg|Edge/i},{name:"Firefox",regex:/Firefox|FxiOS/i},{name:"Opera",regex:/Opera|OPR/i},{name:"Internet Explorer",regex:/MSIE|Trident/i}],b=[{name:"Windows",regex:/Windows NT ([\d.]+)/i},{name:"MacOS",regex:/Mac OS X ([\d_]+)/i},{name:"Android",regex:/Android ([\d.]+)/i},{name:"iOS",regex:/OS ([\d_]+) like Mac OS X/i},{name:"Linux",regex:/Linux/i}],E=f.find(a=>a.regex.test(o))?.type||"Unknown",x=i.find(a=>a.regex.test(o))?.name||"Unknown",w=b.find(a=>a.regex.test(o)),C=w&&o.match(w.regex)?.[1]?.replace(/_/g,".")||"",M=w?w.name:"Unknown";return C=C?`${M} ${C}`:M,`${x} ${E} ${C}`},changeOpacity:y}})();var U=(()=>{let r=(f,i,b)=>({code:f,data:i,error:b}),u=(f=0)=>({love:f}),y=({uuid:f,own:i,name:b,presence:E,comment:x,created_at:w,is_admin:C,gif_url:M,ip:a,user_agent:n,comments:e,like:s})=>({uuid:f,own:i,name:b,presence:E,comment:x,created_at:w,is_admin:C??!1,gif_url:M,ip:a,user_agent:n,comments:e?.map(y)??[],like:u(s?.love??0)});return{uuidResponse:({uuid:f})=>({uuid:f}),baseResponse:r,tokenResponse:({token:f})=>({token:f}),statusResponse:({status:f})=>({status:f}),commentResponse:({name:f,presence:i,comment:b,is_admin:E,gif_url:x,created_at:w})=>({name:f,presence:i,comment:b,is_admin:E,gif_url:x,created_at:w}),likeCommentResponse:u,getCommentResponse:y,getCommentsResponse:f=>f.map(y),commentShowMore:(f,i=!1)=>({uuid:f,show:i}),postCommentRequest:(f,i,b,E,x)=>({id:f,name:i,presence:b,comment:E,gif_id:x}),postSessionRequest:(f,i)=>({email:f,password:i}),updateCommentRequest:(f,i,b)=>({presence:f,comment:i,gif_id:b})}})();var j="GET",ee="PUT",W="POST",te="PATCH",ne="DELETE",V=200,K=201,me=500,D=(r,u)=>{let y=new AbortController,d=document.body.getAttribute("data-url"),p={signal:y.signal,method:String(r).toUpperCase(),headers:new Headers({Accept:"application/json","Content-Type":"application/json"})};return window.addEventListener("offline",()=>y.abort()),window.addEventListener("popstate",()=>y.abort()),window.addEventListener("beforeunload",()=>y.abort()),d&&d.slice(-1)==="/"&&(d=d.slice(0,-1)),{send(l=null){return fetch(d+u,p).then(m=>m.json().then(g=>{if(m.status>=me&&(g.message??g[0]))throw new Error(g.message??g[0]);if(g.error)throw new Error(g.error[0]);return l&&(g.data=l(g.data)),U.baseResponse(g.code,g.data,g.error)})).catch(m=>{if(m.name==="AbortError")return console.warn("Fetch abort:",m),m;throw alert(m),new Error(m)})},download(){return fetch(d+u,p).then(l=>{if(l.status!==V)return!1;let m=document.querySelector("a[download]");m&&document.body.removeChild(m);let g=l.headers.get("content-disposition")?.match(/filename="(.+)"/)?.[1]??"download.csv";return l.blob().then(I=>{let k=document.createElement("a"),S=window.URL.createObjectURL(I);return k.href=S,k.download=g,document.body.appendChild(k),k.click(),document.body.removeChild(k),window.URL.revokeObjectURL(S),!0})}).catch(l=>{if(l.name==="AbortError")return console.warn("Fetch abort:",l),l;throw alert(l),new Error(l)})},withCancel(l){return(async()=>(await l,y.abort()))(),this},default(l=null){return p.headers=new Headers(l??{}),fetch(u,p)},token(l){return l.split(".").length===3?(p.headers.append("Authorization","Bearer "+l),this):(p.headers.append("x-access-key",l),this)},body(l){return p.body=JSON.stringify(l),this}}};var Q=(()=>{let r=null,u=null,y=!1,d=1e3*60*60*6,p="images",l=async o=>{let f=o.getAttribute("data-src"),i="x-expiration-time",b="image/webp",E=new Image;if(E.onload=()=>{o.src=E.src,o.width=E.width,o.height=E.height,E.remove(),_.complete("image")},r.has(f)){E.src=r.get(f);return}let x=M=>new Promise((a,n)=>{let e=document.createElement("canvas");e.width=M.width,e.height=M.height,e.getContext("2d").drawImage(M,0,0);let s=h=>{e.remove(),h?a(h):n(new Error("Failed to convert image to WebP"))};e.onerror=n,e.toBlob(s,b,.8)}),w=(M,a=3,n=1e3)=>D(j,f).default().then(e=>e.blob()).then(e=>window.createImageBitmap(e)).then(e=>x(e)).then(e=>{let s=new Headers;return s.set("Content-Type",b),s.set("Content-Length",String(e.size)),s.set(i,String(Date.now()+d)),M.put(f,new Response(e,{headers:s})).then(()=>e)}).catch(e=>{if(a<=0)throw e;return console.warn("Retrying fetch:"+f),new Promise(s=>v.timeOut(()=>s(w(M,a-1,n+1e3)),n))}),C=M=>M.match(f).then(a=>a?Date.now()<=parseInt(a.headers.get(i))?a.blob():M.delete(f).then(n=>n?w(M):a.blob()):w(M));await caches.open(p).then(M=>C(M)).then(M=>{E.src=URL.createObjectURL(M),r.set(f,E.src)}).catch(()=>_.invalid("image"))},m=o=>{o.onerror=()=>_.invalid("image"),o.onload=()=>{o.width=o.naturalWidth,o.height=o.naturalHeight,_.complete("image")},o.complete&&o.naturalWidth!==0&&o.naturalHeight!==0?_.complete("image"):o.complete&&_.invalid("image")},g=()=>y,I=o=>{d=Number(o)},k=()=>{(async()=>{for(let o of u)o.hasAttribute("data-src")?await l(o):m(o)})()};return{init:()=>(r=new Map,u=document.querySelectorAll("img"),u.forEach(_.add),y=Array.from(u).some(o=>o.hasAttribute("data-src")),{load:k,setTtl:I,hasDataSrc:g})}})();var Z=(()=>{let r=null,u=null,y=null,d=null,p=!1,l=1e3*60*60*6,m="audio",g="audio/mpeg",I="x-expiration-time",k='<i class="fa-solid fa-circle-pause spin-button"></i>',S='<i class="fa-solid fa-circle-play"></i>',o=async()=>{if(navigator.onLine){r.disabled=!0;try{await d,await u.play(),p=!0,r.disabled=!1,r.innerHTML=k}catch(w){p=!1,alert(w)}}},f=()=>{p=!1,u.pause(),r.innerHTML=S},i=(w,C=3,M=1e3)=>D(j,y).default().then(a=>a.blob()).then(a=>{let n=new Headers;return n.set("Content-Type",g),n.set("Content-Length",String(a.size)),n.set(I,String(Date.now()+l)),w.put(y,new Response(a,{headers:n})).then(()=>a)}).catch(a=>{if(C<=0)throw a;return console.warn("Retrying fetch:"+y),new Promise(n=>v.timeOut(()=>n(i(w,C-1,M+1e3)),M))}),b=()=>caches.open(m).then(w=>w.match(y).then(C=>C?Date.now()<=parseInt(C.headers.get(I))?C.blob():w.delete(y).then(M=>M?i(w):C.blob()):i(w))).then(w=>URL.createObjectURL(w));return{init:async()=>{r=document.getElementById("button-music"),y=r.getAttribute("data-url"),document.addEventListener("undangan.open",()=>{r.style.display="block"});try{u=new Audio(await b()),u.volume=1,u.loop=!0,u.muted=!1,u.currentTime=0,u.autoplay=!1,u.controls=!1,d=new Promise(w=>u.addEventListener("canplay",w,{once:!0})),_.complete("audio")}catch{_.invalid("audio")}r.addEventListener("offline",f),r.addEventListener("click",()=>p?f():o())},play:o,setTtl:w=>l=Number(w)}})();var oe={tab:y=>window.bootstrap.Tab.getOrCreateInstance(document.getElementById(y)),modal:y=>window.bootstrap.Modal.getOrCreateInstance(document.getElementById(y))};var R=r=>{let u=(m=null)=>{let g=JSON.parse(localStorage.getItem(r));return m?g[String(m)]:g},y=(m,g)=>{let I=u();I[String(m)]=g,localStorage.setItem(r,JSON.stringify(I))},d=m=>Object.keys(u()).includes(String(m)),p=m=>{if(!d(m))return;let g=u();delete g[String(m)],localStorage.setItem(r,JSON.stringify(g))},l=()=>localStorage.setItem(r,"{}");return localStorage.getItem(r)||l(),{set:y,get:u,has:d,clear:l,unset:p}};var J=(()=>{let r={"#000000":"#ffffff","#ffffff":"#000000","#212529":"#f8f9fa","#f8f9fa":"#212529"},u=["#ffffff","#f8f9fa"],y=["#000000","#212529"],d=!1,p=null,l=null,m=()=>p.set("active","light"),g=()=>p.set("active","dark"),I=x=>{let w=l.getAttribute("content");l.setAttribute("content",x.some(C=>C===w)?r[w]:w)},k=()=>{m(),document.documentElement.setAttribute("data-bs-theme","light"),I(y)},S=()=>{g(),document.documentElement.setAttribute("data-bs-theme","dark"),I(u)},o=(x=null,w=null)=>{let C=p.get("active")==="dark";return x&&w?C?x:w:C};return{init:()=>{switch(p=R("theme"),l=document.querySelector('meta[name="theme-color"]'),p.has("active")||(window.matchMedia("(prefers-color-scheme: dark)").matches?g():m()),document.documentElement.getAttribute("data-bs-theme")){case"dark":g();break;case"light":m();break;default:d=!0}o()?S():k()},spyTop:()=>{let x=C=>C.filter(M=>M.isIntersecting).forEach(M=>{let a=M.target.classList.contains("bg-white-black")?o(y[0],u[0]):o(y[1],u[1]);l.setAttribute("content",a)}),w=new IntersectionObserver(x,{rootMargin:"0% 0% -95% 0%"});document.querySelectorAll("section").forEach(C=>w.observe(C))},change:()=>o()?k():S(),isDarkMode:o,isAutoMode:()=>d}})();var O=(()=>{let r=null,u=()=>r.get("token"),y=k=>r.set("token",k),d=k=>D(W,"/api/session").body(k).send(U.tokenResponse).then(S=>(S.code===V&&y(S.data.token),S.code===V),()=>!1),p=()=>r.unset("token"),l=()=>String(u()??".").split(".").length===3;return{init:()=>{r=R("session")},guest:()=>D(j,"/api/config").token(u()).send().then(k=>{if(k.code!==V)throw new Error("failed to get config.");let S=R("config");for(let[o,f]of Object.entries(k.data))S.set(o,f);return k}),login:d,logout:p,decode:()=>{if(!l())return null;try{return JSON.parse(window.atob(u().split(".")[1]))}catch{return null}},isAdmin:l,setToken:y,getToken:u}})();var se=(()=>{let r=null,u=!0,y=["input[data-offline-disabled]","button[data-offline-disabled]","select[data-offline-disabled]","textarea[data-offline-disabled]"],d=()=>u,p=()=>{let o=r.firstElementChild.firstElementChild;o.classList.remove("bg-success"),o.classList.add("bg-danger"),o.firstElementChild.innerHTML='<i class="fa-solid fa-ban me-2"></i>Koneksi tidak tersedia'},l=()=>{let o=r.firstElementChild.firstElementChild;o.classList.remove("bg-danger"),o.classList.add("bg-success"),o.firstElementChild.innerHTML='<i class="fa-solid fa-cloud me-2"></i>Koneksi tersedia kembali'},m=async()=>{u&&(await v.changeOpacity(r,!1),p())},g=()=>{document.querySelectorAll(y.join(", ")).forEach(o=>{o.dispatchEvent(new Event(d()?"online":"offline")),o.setAttribute("data-offline-disabled",d()?"false":"true"),o.tagName==="BUTTON"?d()?o.classList.remove("disabled"):o.classList.add("disabled"):d()?o.removeAttribute("disabled"):o.setAttribute("disabled","true")})},I=()=>{u=!1,p(),v.changeOpacity(r,!0),g()},k=()=>{u=!0,l(),v.timeOut(m,3e3),g()};return{init:()=>{window.addEventListener("online",k),window.addEventListener("offline",I),r=document.getElementById("offline-mode"),r.innerHTML=`
        <div class="d-flex justify-content-center mx-auto">
            <div class="d-flex justify-content-center align-items-center rounded-pill my-2 bg-danger shadow">
                <small class="text-center py-1 px-2 mx-1 mt-1 mb-0 text-white" style="font-size: 0.8rem;"></small>
            </div>
        </div>`},isOnline:d}})();var N=(()=>{let r="gifs",u="default",y={128:2,256:3,512:4,768:5},d={id:"ID",en:"US",fr:"FR",de:"DE",es:"ES",zh:"CN",ja:"JP",ko:"KR",ar:"SA",ru:"RU",it:"IT",nl:"NL",pt:"PT",tr:"TR",th:"TH",vi:"VN",ms:"MY",hi:"IN"},p=null,l=null,m=null,g=null,I=async t=>{if(p.has(t))return p.get(t);let c=(L,q=3,B=1e3)=>D(j,t).default().then(P=>P.blob().then(z=>L.put(t,new Response(z,{headers:new Headers(P.headers)})).then(()=>z))).catch(P=>{if(q<=0)throw P;return console.warn("Retrying fetch:"+t),new Promise(z=>v.timeOut(()=>z(c(L,q-1,B+1e3)),B))}),T=L=>L.match(t).then(q=>{if(!q)return c(L);let B=q.headers.get("expires"),P=B?new Date(B).getTime():0;return Date.now()>P?L.delete(t).then(z=>z?c(L):q.blob()):q.blob()});return await caches.open(r).then(L=>T(L)).then(L=>URL.createObjectURL(L)).then(L=>(p.set(t,L),L))},k=async(t,c)=>{let{id:T,media_formats:{tinygif:{url:A}},content_description:L}=c;t.pointer===-1||t.pointer===t.col-1?t.pointer=0:t.pointer++;let q=0;for(let B of t.lists.childNodes)q===t.pointer&&await I(A).then(P=>{B.insertAdjacentHTML("beforeend",`
                    <figure class="gif-figure m-0 position-relative">
                        <div onclick="undangan.comment.gif.click('${t.uuid}', '${T}', '${v.base64Encode(A)}')" class="gif-checklist position-absolute justify-content-center align-items-center top-0 end-0 bg-overlay-auto p-1 m-1 rounded-circle border shadow-sm z-1">
                            <i class="fa-solid fa-circle-check"></i>
                        </div>
                        <img src="${P}" class="img-fluid" alt="${v.escapeHtml(L)}" style="width: 100%;">
                    </figure>
                `)}),q++},S=t=>{let c=t.lists,T=document.getElementById(`gif-loading-${t.uuid}`);return c.classList.contains("d-none")||T.classList.replace("d-none","d-flex"),c.setAttribute("data-continue","false"),c.classList.replace("overflow-y-scroll","overflow-y-hidden"),{release:()=>{c.classList.contains("d-none")||T.classList.replace("d-flex","d-none"),c.setAttribute("data-continue","true"),c.classList.replace("overflow-y-hidden","overflow-y-scroll")}}},o=(t,c,T)=>{let A=!0;t.last=new Promise(L=>{let q=S(t);(async()=>(await c,A=!1))(),(async()=>{try{let B=await T;t.next=B?.next;for(let P of B.results)A&&(t.gifs.push(P),await k(t,P))}catch(B){B.name==="AbortError"?console.warn("Fetch abort:",B):alert(B)}finally{q.release(),L()}})()})},f=(t,c)=>{c={key:g.get("tenor_key"),media_filter:"tinygif",client_key:"undangan_app",country:g.get("country"),locale:g.get("locale"),...c??{}};let T=Object.keys(c).filter(L=>c[L]!==null&&c[L]!==void 0).filter(L=>typeof c[L]!="object").map(L=>`${L}=${encodeURIComponent(c[L])}`).join("&"),A=D(j,`https://tenor.googleapis.com/v2${t}?${T}`);return c.reqCancel&&(A=A.withCancel(c.reqCancel)),A.default().then(L=>L.json()).then(L=>{if(!L.error)return L;throw new Error(L.error.message)})},i=async t=>{if(!t.next||t.next.length===0)return;let c=t.query&&t.query.trim().length,T={pos:t.next,limit:t.limit};c&&(T.q=t.query),t.last&&(await t.last,t.last=null),T.reqCancel=new Promise(L=>{t.reqs.push(L)});let A=(t.lists.scrollHeight-t.lists.clientHeight)*.9;t.lists.scrollTop>A&&t.lists.getAttribute("data-continue")==="true"&&o(t,T.reqCancel,f(c?"/search":"/featured",T))},b=t=>`
        <label for="gif-search-${t}" class="form-label my-1"><i class="fa-solid fa-photo-film me-2"></i>Gif</label>

        <div class="d-flex mb-3" id="gif-search-nav-${t}">
            <button class="btn btn-secondary btn-sm rounded-4 shadow-sm me-1 my-1" onclick="undangan.comment.gif.back('${t}')" data-offline-disabled="false"><i class="fa-solid fa-arrow-left"></i></button>
            <input type="text" name="gif-search" id="gif-search-${t}" autocomplete="off" class="form-control shadow-sm rounded-4" placeholder="Cari GIF oleh Tenor" data-offline-disabled="false">
        </div>

        <div class="position-relative">
            <div class="position-absolute d-flex justify-content-center align-items-center top-50 start-50 translate-middle w-100 h-100 bg-overlay-auto rounded-4 z-3" id="gif-loading-${t}">
                <div class="spinner-border" role="status"></div>
            </div>
            <div id="gif-lists-${t}" class="d-flex rounded-4 p-0 overflow-y-scroll border" data-continue="true" style="height: 15rem;"></div>
        </div>

        <figure class="d-flex m-0 position-relative" id="gif-result-${t}">
            <div onclick="undangan.comment.gif.cancel('${t}')" id="gif-cancel-${t}" class="d-none position-absolute justify-content-center align-items-center top-0 end-0 bg-overlay-auto p-2 m-1 rounded-circle border shadow-sm z-1" style="cursor: pointer;">
                <i class="fa-solid fa-circle-xmark"></i>
            </div>
        </figure>`,E=async t=>{let c=0;for(let[A,L]of Object.entries(y))c=L,t.lists.clientWidth>=parseInt(A)&&(t.col=c);if(t.col===null&&(t.col=c),t.pointer=-1,t.limit=t.col*5,t.lists.innerHTML='<div class="d-flex flex-column"></div>'.repeat(t.col),t.gifs.length===0)return;let T=S(t);for(let A of t.gifs)await k(t,A);T.release()},x=async(t,c)=>{t.query=c.value,(!t.query||t.query.trim().length===0)&&(t.query=null),t.reqs.forEach(A=>A()),t.reqs=[],t.last&&(await t.last,t.last=null);let T=new Promise(A=>{t.reqs.push(A)});t.next=null,t.gifs=[],t.pointer=-1,await E(t),o(t,T,f(t.query===null?"/featured":"/search",{q:t.query,limit:t.limit,reqCancel:T}))},w=t=>{if(!l.has(t)){let c=document.getElementById(`gif-form-${t}`);c.innerHTML=b(t);let T=v.debounce(E,500),A=v.debounce(x,500);l.set(t,{uuid:t,last:null,limit:null,query:null,next:null,col:null,pointer:-1,gifs:[],reqs:[],container:c,lists:document.getElementById(`gif-lists-${t}`)});let L=l.get(t);L.lists.addEventListener("scroll",()=>i(L)),window.addEventListener("resize",()=>T(L)),document.getElementById(`gif-search-${t}`).addEventListener("input",q=>A(L,q.target))}return l.get(t)};return{default:u,init:()=>{p=new Map,m=new Map,l=new Map,g=R("config");let t=document.documentElement.lang.toLowerCase();g.set("country",d[t]??"US"),g.set("locale",`${t}_${g.get("country")}`),g.get("tenor_key")===null&&document.querySelector('[onclick="undangan.comment.gif.open(undangan.comment.gif.default)"]')?.remove()},cache:I,back:t=>{w(t).container.classList.toggle("d-none",!0),document.getElementById(`comment-form-${t}`)?.classList.toggle("d-none",!1)},open:async t=>{let c=w(t);c.container.classList.toggle("d-none",!1),document.getElementById(`comment-form-${t}`)?.classList.toggle("d-none",!0),m.has(t)&&m.get(t)(),c.reqs.forEach(A=>A()),c.reqs=[],c.last&&(await c.last,c.last=null);let T=new Promise(A=>{c.reqs.push(A)});await E(c),o(c,T,f("/featured",{limit:c.limit,reqCancel:T}))},cancel:t=>{let c=document.getElementById(`gif-result-${t}`);c.removeAttribute("data-id"),c.querySelector(`#gif-cancel-${t}`).classList.replace("d-flex","d-none"),c.querySelector("img").remove(),w(t).lists.classList.replace("d-none","d-flex"),document.getElementById(`gif-search-nav-${t}`).classList.replace("d-none","d-flex")},click:(t,c,T)=>{let A=document.getElementById(`gif-result-${t}`);A.setAttribute("data-id",c),A.querySelector(`#gif-cancel-${t}`).classList.replace("d-none","d-flex"),A.insertAdjacentHTML("beforeend",`<img src="${p.get(v.base64Decode(T))}" class="img-fluid mx-auto gif-image rounded-4" alt="selected-gif">`),w(t).lists.classList.replace("d-flex","d-none"),document.getElementById(`gif-search-nav-${t}`).classList.replace("d-flex","d-none")},remove:(t=null)=>{t?l.has(t)&&(l.get(t).reqs.forEach(c=>c()),l.delete(t),m.delete(t)):(l.forEach(c=>c.reqs.forEach(T=>T())),l.clear(),m.clear())},isOpen:t=>{if(!l.has(t))return!1;let c=l.get(t);return c.container===null?!1:!c.container.classList.contains("d-none")},onOpen:(t,c)=>m.set(t,c),getResultId:t=>document.getElementById(`gif-result-${t}`)?.getAttribute("data-id")}})();var F=(()=>{let r=null,u=null,y=null,d=null,p=null,l=null,m=250,g=[["*",'<strong class="text-theme-auto">$1</strong>'],["_",'<em class="text-theme-auto">$1</em>'],["~",'<del class="text-theme-auto">$1</del>'],["```",'<code class="font-monospace text-theme-auto">$1</code>']],I=()=>`
        <div class="bg-theme-auto shadow p-3 mx-0 mt-0 mb-3 rounded-4">
            <div class="d-flex justify-content-between align-items-center placeholder-wave">
                <span class="placeholder bg-secondary col-5 rounded-3 my-1"></span>
                <span class="placeholder bg-secondary col-3 rounded-3 my-1"></span>
            </div>
            <hr class="my-1">
            <p class="placeholder-wave m-0">
                <span class="placeholder bg-secondary col-6 rounded-3"></span>
                <span class="placeholder bg-secondary col-5 rounded-3"></span>
                <span class="placeholder bg-secondary col-12 rounded-3 my-1"></span>
            </p>
        </div>`,k=e=>(g.forEach(s=>{let h=s[0],$=s[1];e=e.replace(new RegExp(`\\${h}(?=\\S)(.*?)(?<!\\s)\\${h}`,"gs"),$)}),e),S=e=>`
        <button style="font-size: 0.8rem;" onclick="undangan.comment.like.love(this)" data-uuid="${e.uuid}" class="btn btn-sm btn-outline-auto ms-auto rounded-3 p-0 shadow-sm d-flex justify-content-start align-items-center" data-offline-disabled="false">
            <span class="my-0 mx-1" data-count-like="${e.like.love}">${e.like.love}</span>
            <i class="me-1 ${y.has(e.uuid)?"fa-solid fa-heart text-danger":"fa-regular fa-heart"}"></i>
        </button>`,o=e=>{let s=e.gif_url!==null&&e.gif_url!==void 0,h=`<div class="d-flex justify-content-start align-items-center" data-button-action="${e.uuid}">`;return(d.get("can_reply")===!0||d.get("can_reply")===void 0)&&(h+=`<button style="font-size: 0.8rem;" onclick="undangan.comment.reply(this)" data-uuid="${e.uuid}" class="btn btn-sm btn-outline-auto rounded-4 py-0 me-1 shadow-sm" data-offline-disabled="false">Reply</button>`),u.has(e.uuid)&&(d.get("can_edit")===!0||d.get("can_edit")===void 0)&&!(s&&d.get("tenor_key")===null)&&(h+=`<button style="font-size: 0.8rem;" onclick="undangan.comment.edit(this)" data-uuid="${e.uuid}" class="btn btn-sm btn-outline-auto rounded-4 py-0 me-1 shadow-sm" data-offline-disabled="false">Edit</button>`),O.isAdmin()?h+=`<button style="font-size: 0.8rem;" onclick="undangan.comment.remove(this)" data-uuid="${e.uuid}" class="btn btn-sm btn-outline-auto rounded-4 py-0 me-1 shadow-sm" data-own="${e.own}" data-offline-disabled="false">Delete</button>`:u.has(e.uuid)&&(d.get("can_delete")===!0||d.get("can_delete")===void 0)&&(h+=`<button style="font-size: 0.8rem;" onclick="undangan.comment.remove(this)" data-uuid="${e.uuid}" class="btn btn-sm btn-outline-auto rounded-4 py-0 me-1 shadow-sm" data-offline-disabled="false">Delete</button>`),h+="</div>",h},f=(e,s)=>{let h=l.get("show").includes(e);return`<a class="text-theme-auto" style="font-size: 0.8rem;" onclick="undangan.comment.showOrHide(this)" data-uuid="${e}" data-uuids="${s.join(",")}" data-show="${h?"true":"false"}" role="button" class="me-auto ms-1 py-0">${h?"Hide replies":`Show replies (${s.length})`}</a>`},i=e=>`
        <div class="d-flex justify-content-between align-items-center" id="button-${e.uuid}">
            ${o(e)}
            ${e.comments.length>0?f(e.uuid,e.comments.map(s=>s.uuid)):""}
            ${S(e)}
        </div>`,b=e=>e.ip===void 0||e.user_agent===void 0||e.is_admin?"":`
        <div class="mb-1 mt-3">
            <p class="text-theme-auto mb-1 mx-0 mt-0 p-0" style="font-size: 0.7rem;" id="ip-${e.uuid}"><i class="fa-solid fa-location-dot me-1"></i>${v.escapeHtml(e.ip)} ${p.has(e.ip)?`<strong>${p.get(e.ip)}</strong>`:'<span class="mb-1 placeholder col-2 rounded-3"></span>'}</p>
            <p class="text-theme-auto m-0 p-0" style="font-size: 0.7rem;"><i class="fa-solid fa-mobile-screen-button me-1"></i>${v.parseUserAgent(v.escapeHtml(e.user_agent))}</p>
        </div>`,E=(e,s)=>s?'class="bg-theme-auto shadow p-3 mx-0 mt-0 mb-3 rounded-4" data-parent="true"':`class="${l.get("hidden").find(h=>h.uuid===e.uuid).show?"":"d-none"} overflow-x-scroll mw-100 border-start bg-theme-auto py-2 ps-2 pe-0 my-2 ms-2 me-0"`,x=(e,s)=>e.is_admin?`<strong class="me-1">${v.escapeHtml(r.get("name")??d.get("name"))}</strong><i class="fa-solid fa-certificate text-primary"></i>`:s?`<strong class="me-1">${v.escapeHtml(e.name)}</strong><i id="badge-${e.uuid}" class="fa-solid ${e.presence?"fa-circle-check text-success":"fa-circle-xmark text-danger"}"></i>`:`<strong>${v.escapeHtml(e.name)}</strong>`,w=async(e,s)=>{let h=k(v.escapeHtml(e.comment)),$=h.length>m,H=e.gif_url!==null&&e.gif_url!==void 0,t=`
        <div class="d-flex justify-content-between align-items-center">
            <p class="text-theme-auto text-truncate m-0 p-0" style="font-size: 0.95rem;">${x(e,s)}</p>
            <small class="text-theme-auto m-0 p-0" style="font-size: 0.75rem;">${e.created_at}</small>
        </div>
        <hr class="my-1">
        `;if(H){let c=await N.cache(e.gif_url);return t+`
            <div class="d-flex justify-content-center align-items-center my-2">
                <img src="${c}" id="img-gif-${e.uuid}" class="img-fluid mx-auto gif-image rounded-4" alt="selected-gif">
            </div>
            `}return t+`
        <p class="text-theme-auto my-1 mx-0 p-0" style="white-space: pre-wrap !important; font-size: 0.95rem;" ${$?`data-comment="${v.base64Encode(h)}"`:""} id="content-${e.uuid}">${$?h.slice(0,m)+"...":h}</p>
        ${$?`<p class="d-block mb-2 mt-0 mx-0 p-0"><a class="text-theme-auto" role="button" style="font-size: 0.85rem; display: block;" data-show="false" onclick="undangan.comment.showMore(this, '${e.uuid}')">Selengkapnya</a></p>`:""}`},C=async(e,s)=>{let h=await w(e,s),$="";for(let H of e.comments)$+=await C(H,!1);return`
        <div ${E(e,s)} id="${e.uuid}" style="overflow-wrap: break-word !important;">
            <div id="body-content-${e.uuid}" data-tapTime="0" data-liked="false" tabindex="0">
                ${h}
            </div>
            ${b(e)}
            ${i(e)}
            <div id="reply-content-${e.uuid}">${$}</div>
        </div>`};return{init:()=>{r=R("user"),u=R("owns"),y=R("likes"),d=R("config"),p=R("tracker"),l=R("comment")},renderEdit:(e,s,h,$)=>{let H=document.createElement("div");return H.classList.add("my-2"),H.id=`inner-${e}`,H.innerHTML=`
        <p class="my-1 mx-0 p-0" style="font-size: 0.95rem;"><i class="fa-solid fa-pen me-2"></i>Edit</p>
        ${h?`
        <select class="form-select shadow-sm mb-2 rounded-4" id="form-inner-presence-${e}" data-offline-disabled="false">
            <option value="1" ${s?"selected":""}>Datang</option>
            <option value="2" ${s?"":"selected"}>Berhalangan</option>
        </select>`:""}
        ${$?`${d.get("tenor_key")===null?"":`<div class="d-none mb-2" id="gif-form-${e}"></div>`}`:`<textarea class="form-control shadow-sm rounded-4 mb-2" id="form-inner-${e}" minlength="1" maxlength="1000" placeholder="Type update comment" rows="3" data-offline-disabled="false"></textarea>    
        `}
        <div class="d-flex justify-content-end align-items-center mb-0">
            <button style="font-size: 0.8rem;" onclick="undangan.comment.cancel('${e}')" class="btn btn-sm btn-outline-auto rounded-4 py-0 me-1" data-offline-disabled="false">Cancel</button>
            <button style="font-size: 0.8rem;" onclick="undangan.comment.update(this)" data-uuid="${e}" class="btn btn-sm btn-outline-auto rounded-4 py-0" data-offline-disabled="false">Update</button>
        </div>`,H},renderReply:e=>{let s=document.createElement("div");return s.classList.add("my-2"),s.id=`inner-${e}`,s.innerHTML=`
        <p class="my-1 mx-0 p-0" style="font-size: 0.95rem;"><i class="fa-solid fa-reply me-2"></i>Reply</p>
        <div class="d-block mb-2" id="comment-form-${e}">
            <div class="position-relative">
                ${d.get("tenor_key")===null?"":`<button class="btn btn-secondary btn-sm rounded-4 shadow-sm me-1 my-1 position-absolute bottom-0 end-0" onclick="undangan.comment.gif.open('${e}')" aria-label="button gif" data-offline-disabled="false"><i class="fa-solid fa-photo-film"></i></button>`}
                <textarea class="form-control shadow-sm rounded-4 mb-2" id="form-inner-${e}" minlength="1" maxlength="1000" placeholder="Type reply comment" rows="3" data-offline-disabled="false"></textarea>
            </div>
        </div>
        <div class="d-none mb-2" id="gif-form-${e}"></div>
        <div class="d-flex justify-content-end align-items-center mb-0">
            <button style="font-size: 0.8rem;" onclick="undangan.comment.cancel('${e}')" class="btn btn-sm btn-outline-auto rounded-4 py-0 me-1" data-offline-disabled="false">Cancel</button>
            <button style="font-size: 0.8rem;" onclick="undangan.comment.send(this)" data-uuid="${e}" class="btn btn-sm btn-outline-auto rounded-4 py-0" data-offline-disabled="false">Send</button>
        </div>`,s},renderLoading:I,renderReadMore:f,renderInnerContent:e=>C(e,!1),renderContent:e=>C(e,!0),convertMarkdownToHTML:k,maxCommentLength:m}})();var ae=()=>window.confetti.shapeFromPath({path:"M167 72c19,-38 37,-56 75,-56 42,0 76,33 76,75 0,76 -76,151 -151,227 -76,-76 -151,-151 -151,-227 0,-42 33,-75 75,-75 38,0 57,18 76,56z",matrix:[.03333333333333333,0,0,.03333333333333333,-5.566666666666666,-5.533333333333333]}),ie=()=>{window.confetti({origin:{y:1},zIndex:1057})},re=(r=15)=>{let u=r*1e3,y=Date.now()+u,d=ae(),p=["#FFC0CB","#FF1493","#C71585"],l=(m,g)=>Math.random()*(g-m)+m;(function m(){let g=y-Date.now();p.forEach(I=>{window.confetti({particleCount:1,startVelocity:0,ticks:Math.max(50,75*(g/u)),origin:{x:Math.random(),y:Math.abs(Math.random()-g/u)},zIndex:1057,colors:[I],shapes:[d],drift:l(-.5,.5),gravity:l(.5,1),scalar:l(.5,1)})}),g>0&&requestAnimationFrame(m)})()},le=r=>{if(!window.confetti)return;let u=Date.now()+25,y=Math.max(.3,Math.min(1,r.getBoundingClientRect().top/window.innerHeight+.2)),d=ae(),p=["#FF69B4","#FF1493"];(function l(){p.forEach(m=>{window.confetti({particleCount:2,angle:60,spread:55,shapes:[d],origin:{x:0,y},zIndex:1057,colors:[m]}),window.confetti({particleCount:2,angle:120,spread:55,shapes:[d],origin:{x:1,y},zIndex:1057,colors:[m]})}),Date.now()<u&&requestAnimationFrame(l)})()};var X=(()=>{let r=null,u=async p=>{let l=p.firstElementChild,m=p.lastElementChild,g=p.getAttribute("data-uuid"),I=parseInt(l.getAttribute("data-count-like"));p.disabled=!0,r.has(g)?await D(te,"/api/comment/"+r.get(g)).token(O.getToken()).send(U.statusResponse).then(k=>{k.data.status&&(r.unset(g),m.classList.remove("fa-solid","text-danger"),m.classList.add("fa-regular"),l.setAttribute("data-count-like",String(I-1)))}):await D(W,"/api/comment/"+g).token(O.getToken()).send(U.uuidResponse).then(k=>{k.code===K&&(r.set(g,k.data.uuid),m.classList.remove("fa-regular"),m.classList.add("fa-solid","text-danger"),l.setAttribute("data-count-like",String(I+1)))}),l.innerText=l.getAttribute("data-count-like"),p.disabled=!1};return{init:()=>{r=R("likes")},love:u,tapTap:async p=>{if(!navigator.onLine)return;let l=Date.now(),m=l-parseInt(p.getAttribute("data-tapTime")),g=p.id.replace("body-content-",""),I=m<300&&m>0,k=!r.has(g)&&p.getAttribute("data-liked")!=="true";if(I&&k){navigator.vibrate&&navigator.vibrate(100),le(p);let S=document.querySelector(`[onclick="undangan.comment.like.love(this)"][data-uuid="${g}"]`);p.setAttribute("data-liked","true"),await u(S),p.setAttribute("data-liked","false")}p.setAttribute("data-tapTime",l)}}})();var G=(()=>{let r=10,u=0,y=0,d=null,p=null,l=null,m=null,g=null,I=s=>{r=Number(s)},k=()=>r,S=()=>u,o=()=>y,f=()=>p.classList.contains("disabled")?null:p.classList.add("disabled"),i=()=>p.classList.contains("disabled")?p.classList.remove("disabled"):null,b=()=>l.classList.contains("disabled")?null:l.classList.add("disabled"),E=()=>l.classList.contains("disabled")?l.classList.remove("disabled"):null,x=()=>{m.classList.contains("d-none")&&m.classList.remove("d-none")},w=s=>{s.disabled=!0;let h=s.innerHTML;s.innerHTML=v.loader.replace("ms-0 me-1","mx-1");let $=async()=>{let c=new Promise(T=>g.addEventListener("comment.result",T));g.dispatchEvent(new Event("comment.show")),await c,s.disabled=!1,s.innerHTML=h,g.scrollIntoView({behavior:"smooth"})};return{next:async()=>{u+=r,s.innerHTML="Next"+s.innerHTML,await $(),d.innerText=String(parseInt(d.innerText)+1)},prev:async()=>{u-=r,s.innerHTML=s.innerHTML+"Prev",await $(),d.innerText=String(parseInt(d.innerText)-1)}}};return{init:()=>{m=document.getElementById("pagination"),m.innerHTML=`
        <ul class="pagination mb-2 shadow-sm rounded-4">
            <li class="page-item disabled" id="previous">
                <button class="page-link rounded-start-4" onclick="undangan.comment.pagination.previous(this)" data-offline-disabled="false">
                    <i class="fa-solid fa-circle-left me-1"></i>Prev
                </button>
            </li>
            <li class="page-item disabled">
                <span class="page-link text-theme-auto" id="page">1</span>
            </li>
            <li class="page-item" id="next">
                <button class="page-link rounded-end-4" onclick="undangan.comment.pagination.next(this)" data-offline-disabled="false">
                    Next<i class="fa-solid fa-circle-right ms-1"></i>
                </button>
            </li>
        </ul>`,g=document.getElementById("comments"),d=document.getElementById("page"),p=document.getElementById("previous"),l=document.getElementById("next")},setPer:I,getPer:k,getNext:S,reset:()=>u===0?!1:(u=0,y=0,d.innerText=1,b(),f(),!0),setResultData:s=>{if(y=s,u>0&&i(),y<r){b();return}E(),x()},getResultData:o,previous:async s=>{f(),!(u<0)&&(b(),await w(s).prev())},next:async s=>{b(),!(y<r)&&(f(),await w(s).next())}}})();var Y=(()=>{let r=null,u=null,y=null,d=null,p=[],l=()=>'<div class="text-center p-4 my-2 bg-theme-auto rounded-4 shadow"><p class="fw-bold p-0 m-0" style="font-size: 0.95rem;">Yuk bagikan undangan ini biar banyak komentarnya</p></div>',m=(a,n)=>{document.querySelector(`[data-button-action="${a}"]`).childNodes.forEach(e=>{e.disabled=n})},g=a=>{a.comments&&a.comments.forEach(g);let n=document.getElementById(`body-content-${a.uuid}`);n.addEventListener("touchend",()=>X.tapTap(n))},I=a=>{if(!O.isAdmin()||(a.comments&&a.comments.forEach(I),a.ip===void 0||a.user_agent===void 0||a.is_admin||y.has(a.ip)))return;let n=(e,s,h)=>{document.getElementById(`ip-${e}`).innerHTML=`<i class="fa-solid fa-location-dot me-1"></i>${v.escapeHtml(s)} <strong>${v.escapeHtml(h)}</strong>`};D(j,`https://freeipapi.com/api/json/${a.ip}`).default().then(e=>e.json()).then(e=>{let s=e.cityName+" - "+e.regionName;e.cityName==="-"&&e.regionName==="-"&&(s="localhost"),y.set(a.ip,s),n(a.uuid,a.ip,s)}).catch(e=>n(a.uuid,a.ip,e.message))},k=(a,n=[])=>(a.forEach(e=>{n.find(s=>s.uuid===e.uuid)||n.push(U.commentShowMore(e.uuid)),e.comments&&e.comments.length>0&&k(e.comments,n)}),n),S=()=>{let a=document.getElementById("comments");return a.getAttribute("data-loading")==="false"&&(a.setAttribute("data-loading","true"),a.innerHTML=F.renderLoading().repeat(G.getPer())),D(j,`/api/comment?per=${G.getPer()}&next=${G.getNext()}`).token(O.getToken()).send(U.getCommentsResponse).then(async n=>{let e=n.data.length;if(a.setAttribute("data-loading","false"),p.map(h=>h.uuid).forEach(h=>N.remove(h)),e===0)return G.setResultData(e),a.innerHTML=l(),n;p=k(n.data),d.set("hidden",k(n.data,d.get("hidden")));let s="";for(let h of n.data)s+=await F.renderContent(h);return a.innerHTML=s,n.data.forEach(I),n.data.forEach(g),G.setResultData(e),a.dispatchEvent(new Event("comment.result")),n})},o=a=>{let n=a.getAttribute("data-uuids").split(","),e=a.getAttribute("data-show")==="true",s=a.getAttribute("data-uuid");e?(a.setAttribute("data-show","false"),a.innerText=`Show replies (${n.length})`,d.set("show",d.get("show").filter(h=>h!==s))):(a.setAttribute("data-show","true"),a.innerText="Hide replies",d.set("show",d.get("show").concat([s])));for(let h of n){d.set("hidden",d.get("hidden").map(H=>(H.uuid===h&&(H.show=!e),H)));let $=document.getElementById(h).classList;e?$.add("d-none"):$.remove("d-none")}};return{gif:N,like:X,pagination:G,init:()=>{N.init(),X.init(),F.init(),G.init(),document.getElementById("comments").addEventListener("comment.show",S),r=R("owns"),u=R("user"),y=R("tracker"),d=R("comment"),d.has("hidden")||d.set("hidden",[]),d.has("show")||d.set("show",[])},send:async a=>{let n=a.getAttribute("data-uuid"),e=document.getElementById("form-name"),s=e.value;if(O.isAdmin()&&(s=u.get("name")),s.length===0){alert("Name cannot be empty."),n&&document.getElementById("comment").scrollIntoView({behavior:"smooth"});return}let h=document.getElementById("form-presence");if(!n&&h&&h.value==="0"){alert("Please select your attendance status.");return}let $=N.isOpen(n||"default"),H=N.getResultId(n||"default"),t=document.getElementById(`gif-cancel-${n||"default"}`);if($&&!H){alert("Gif cannot be empty.");return}$&&H&&t.classList.replace("d-flex","d-none");let c=document.getElementById(`form-${n?`inner-${n}`:"comment"}`);if(!$&&c.value.length===0){alert("Comments cannot be empty.");return}!n&&e&&!O.isAdmin()&&(e.disabled=!0),!O.isAdmin()&&h&&h.value!=="0"&&(h.disabled=!0),c&&(c.disabled=!0);let T=document.querySelector(`[onclick="undangan.comment.cancel('${n}')"]`);T&&(T.disabled=!0);let A=v.disableButton(a),L=h?h.value==="1":!0;if(!O.isAdmin()){let B=R("information");B.set("name",s),n||B.set("presence",L)}let q=await D(W,"/api/comment").token(O.getToken()).body(U.postCommentRequest(n,s,L,N.isOpen(n)?null:c.value,H)).send(U.getCommentResponse).then(B=>B,()=>null);if(e&&(e.disabled=!1),c&&(c.disabled=!1),T&&(T.disabled=!1),h&&(h.disabled=!1),$&&H&&t.classList.replace("d-none","d-flex"),A.restore(),!(!q||q.code!==K)){if(r.set(q.data.uuid,q.data.own),c&&(c.value=null),$&&H&&t.dispatchEvent(new Event("click")),!n){let B=document.getElementById("comments");if(G.reset()){await S(),B.scrollIntoView({behavior:"smooth"});return}G.setResultData(B.children.length),G.getResultData()===G.getPer()&&B.lastElementChild.remove(),q.data.is_admin=O.isAdmin();let P=await F.renderContent(q.data);B.insertAdjacentHTML("afterbegin",P),B.scrollIntoView({behavior:"smooth"})}if(n){d.set("hidden",d.get("hidden").concat([U.commentShowMore(q.data.uuid,!0)])),d.set("show",d.get("show").concat([n])),m(n,!1),document.getElementById(`inner-${n}`).remove(),q.data.is_admin=O.isAdmin(),document.getElementById(`reply-content-${n}`).insertAdjacentHTML("beforeend",await F.renderInnerContent(q.data));let B=document.getElementById(`button-${n}`),P=B.querySelector("a"),z=[q.data.uuid];P&&(P.getAttribute("data-show")==="false"&&o(P),P.remove());let de=`button[onclick="undangan.comment.like.love(this)"][data-uuid="${n}"]`;B.querySelector(de).insertAdjacentHTML("beforebegin",F.renderReadMore(n,P?P.getAttribute("data-uuids").split(",").concat(z):z))}g(q.data)}},edit:async a=>{let n=a.getAttribute("data-uuid");if(document.getElementById(`inner-${n}`))return;m(n,!0);let e=v.disableButton(a);await D(j,"/api/comment/"+n).token(O.getToken()).send(U.commentResponse).then(s=>{if(s.code!==V)return s;let h=s.data.gif_url!==null&&s.data.gif_url!==void 0;h&&N.remove(n);let $=document.getElementById(n).getAttribute("data-parent")==="true"&&!O.isAdmin();if(document.getElementById(`button-${n}`).insertAdjacentElement("afterend",F.renderEdit(n,s.data.presence,$,h)),h)return N.onOpen(n,()=>{document.querySelector(`[for="gif-search-${n}"]`)?.remove(),document.querySelector(`[onclick="undangan.comment.gif.back('${n}')"]`)?.remove()}),N.open(n);let H=document.getElementById(`form-inner-${n}`);return H.value=s.data.comment,H.setAttribute("data-original",v.base64Encode(s.data.comment)),s}),e.restore(),a.disabled=!0},reply:a=>{let n=a.getAttribute("data-uuid");document.getElementById(`inner-${n}`)||(N.remove(n),m(n,!0),document.getElementById(`button-${n}`).insertAdjacentElement("afterend",F.renderReply(n)),N.onOpen(n,()=>document.querySelector(`[for="gif-search-${n}"]`)?.remove()))},remove:async a=>{if(!confirm("Are you sure?"))return;let n=a.getAttribute("data-uuid");O.isAdmin()&&r.set(n,a.getAttribute("data-own")),m(n,!0);let e=v.disableButton(a),s=document.querySelector(`[onclick="undangan.comment.like.love(this)"][data-uuid="${n}"]`);if(s.disabled=!0,!await D(ne,"/api/comment/"+r.get(n)).token(O.getToken()).send(U.statusResponse).then(H=>H.data.status,()=>!1)){e.restore(),s.disabled=!1;return}document.querySelectorAll('a[onclick="undangan.comment.showOrHide(this)"]').forEach(H=>{let t=H.getAttribute("data-uuids").split(",");if(t.find(c=>c===n)){let c=t.filter(T=>T!==n).join(",");c.length===0?H.remove():H.setAttribute("data-uuids",c)}}),r.unset(n),document.getElementById(n).remove();let $=document.getElementById("comments");$.children.length===0&&($.innerHTML=l())},update:async a=>{let n=a.getAttribute("data-uuid"),e=!1,s=document.getElementById(`form-inner-presence-${n}`);s&&(s.disabled=!0,e=s.value==="1");let h=!1,$=document.getElementById(`badge-${n}`);$&&(h=$.classList.contains("text-success"));let H=N.isOpen(n),t=N.getResultId(n),c=document.getElementById(`gif-cancel-${n}`),T=document.getElementById(`form-inner-${n}`);if(H&&t&&c.classList.replace("d-flex","d-none"),n&&!H&&v.base64Encode(T.value)===T.getAttribute("data-original")&&h===e){m(n,!1),document.getElementById(`inner-${n}`).remove();return}T&&(T.disabled=!0);let A=document.querySelector(`[onclick="undangan.comment.cancel('${n}')"]`);A&&(A.disabled=!0);let L=v.disableButton(a),q=await D(ee,"/api/comment/"+r.get(n)).token(O.getToken()).body(U.updateCommentRequest(s?e:null,N.isOpen(n)?null:T.value,t)).send(U.statusResponse).then(B=>B.data.status,()=>!1);if(T&&(T.disabled=!1),A&&(A.disabled=!1),s&&(s.disabled=!1),L.restore(),H&&t&&c.classList.replace("d-none","d-flex"),!!q){if(H&&t&&(document.getElementById(`img-gif-${n}`).src=document.getElementById(`gif-result-${n}`)?.querySelector("img").src,c.dispatchEvent(new Event("click"))),m(n,!1),document.getElementById(`inner-${n}`).remove(),!H){let B=document.querySelector(`[onclick="undangan.comment.showMore(this, '${n}')"]`),P=F.convertMarkdownToHTML(v.escapeHtml(T.value)),z=document.getElementById(`content-${n}`);P.length>F.maxCommentLength?(z.innerHTML=B?.getAttribute("data-show")==="false"?P.slice(0,F.maxCommentLength)+"...":P,z.setAttribute("data-comment",v.base64Encode(P)),B?.classList.replace("d-none","d-block")):(z.innerHTML=P,z.removeAttribute("data-comment"),B?.classList.replace("d-block","d-none"))}if(s&&(document.getElementById("form-presence").value=e?"1":"2",R("information").set("presence",e)),!(!s||!$)){if(e){$.classList.remove("fa-circle-xmark","text-danger"),$.classList.add("fa-circle-check","text-success");return}$.classList.remove("fa-circle-check","text-success"),$.classList.add("fa-circle-xmark","text-danger")}}},cancel:a=>{let n=document.getElementById(`form-inner-presence-${a}`),e=n?n.value==="1":!1,s=document.getElementById(`badge-${a}`),h=s?s.classList.contains("text-success"):!1;if(N.isOpen(a)){(!N.getResultId(a)&&h===e||confirm("Are you sure?"))&&(N.remove(a),m(a,!1),document.getElementById(`inner-${a}`).remove());return}let $=document.getElementById(`form-inner-${a}`);($.value.length===0||v.base64Encode($.value)===$.getAttribute("data-original")&&h===e||confirm("Are you sure?"))&&(m(a,!1),document.getElementById(`inner-${a}`).remove())},show:S,showMore:(a,n)=>{let e=document.getElementById(`content-${n}`),s=v.base64Decode(e.getAttribute("data-comment")),h=a.getAttribute("data-show")==="false";e.innerHTML=h?s:s.slice(0,F.maxCommentLength)+"...",a.innerText=h?"Sebagian":"Selengkapnya",a.setAttribute("data-show",h?"true":"false")},showOrHide:o}})();var ce=(()=>{let r=null,u=()=>{let i=document.getElementById("count-down")?.getAttribute("data-time")?.replace(" ","T");if(!i){alert("invalid count down date.");return}let b=new Date(i).getTime();setInterval(()=>{let E=Math.abs(b-Date.now());document.getElementById("day").innerText=Math.floor(E/(1e3*60*60*24)).toString(),document.getElementById("hour").innerText=Math.floor(E%(1e3*60*60*24)/(1e3*60*60)).toString(),document.getElementById("minute").innerText=Math.floor(E%(1e3*60*60)/(1e3*60)).toString(),document.getElementById("second").innerText=Math.floor(E%(1e3*60)/1e3).toString()},1e3)},y=()=>{let i=window.location.search.split("to="),b=null;if(i.length>1&&i[1].length>=1&&(b=window.decodeURIComponent(i[1])),b){let x=document.getElementById("guest-name"),w=document.createElement("div");w.classList.add("m-2"),w.innerHTML=`<small class="mt-0 mb-1 mx-0 p-0">${x?.getAttribute("data-message")}</small><p class="m-0 p-0" style="font-size: 1.5rem">${v.escapeHtml(b)}</p>`,x?.appendChild(w)}let E=document.getElementById("form-name");E&&(E.value=r.get("name")??b)},d=()=>{let i=0,b=document.querySelectorAll(".slide-desktop");b.forEach((x,w)=>{w===i&&(x.classList.add("slide-desktop-active"),v.changeOpacity(x,!0))}),setInterval(async()=>{await v.changeOpacity(b[i],!1),b[i].classList.remove("slide-desktop-active"),i=(i+1)%b.length,b[i].classList.add("slide-desktop-active"),await v.changeOpacity(b[i],!0)},6e3)},p=i=>{i.disabled=!0,document.body.scrollIntoView({behavior:"instant"}),document.dispatchEvent(new Event("undangan.open")),J.isAutoMode()&&(document.getElementById("button-theme").style.display="block"),d(),Z.play(),J.spyTop(),ie(),v.timeOut(re,1500),v.changeOpacity(document.getElementById("welcome"),!1,.04).then(b=>b.remove())},l=i=>{let b=document.getElementById("show-modal-image");b.src=i.src,b.width=i.width,b.height=i.height,oe.modal("modal-image").show()},m=()=>r.set("info",!0),g=()=>{document.querySelectorAll(".font-arabic").forEach(i=>{i.innerHTML=String(i.innerHTML).normalize("NFC")})},I=()=>{document.querySelectorAll("svg").forEach(i=>{v.timeOut(()=>i.classList.add(i.getAttribute("data-class")),parseInt(i.getAttribute("data-time")))})},k=()=>{let i=x=>new Date(x+":00Z").toISOString().replace(/[-:]/g,"").split(".")[0],b=new URL("https://calendar.google.com/calendar/render"),E={action:"TEMPLATE",text:"The Wedding of Wahyu and Riski",dates:`${i("2023-03-15 10:00")}/${i("2023-03-15 11:00")}`,details:"Tanpa mengurangi rasa hormat, kami mengundang Anda untuk berkenan menghadiri acara pernikahan kami. Terima kasih atas perhatian dan doa restu Anda, yang menjadi kebahagiaan serta kehormatan besar bagi kami.",location:"https://goo.gl/maps/ALZR6FJZU3kxVwN86",ctz:"Asia/Jakarta"};Object.entries(E).forEach(([x,w])=>b.searchParams.set(x,w)),document.querySelector("#home button")?.addEventListener("click",()=>window.open(b,"_blank"))},S=async()=>{I(),u(),y(),g(),k(),document.getElementById("root").style.opacity="1",r.has("presence")&&(document.getElementById("form-presence").value=r.get("presence")?"1":"2"),r.get("info")&&document.getElementById("information")?.remove(),window.AOS.init(),document.body.scrollIntoView({behavior:"instant"}),await v.changeOpacity(document.getElementById("welcome"),!0),await v.changeOpacity(document.getElementById("loading"),!1,.04).then(i=>i.remove())},o=()=>{se.init(),_.init(),r=R("information");let i=document.body.getAttribute("data-key");if(document.addEventListener("progress.done",()=>S()),document.addEventListener("hide.bs.modal",()=>document.activeElement?.blur()),(!i||i.length<=0)&&(_.add(),Q.init().load(),Z.init(),document.getElementById("comment")?.remove(),document.querySelector('a.nav-link[href="#comment"]')?.closest("li.nav-item")?.remove()),i&&i.length>0){_.add(),_.add(),_.add();let b=Q.init();b.hasDataSrc()||b.load();let E=new URLSearchParams(window.location.search);O.setToken(E.get("k")??i),window.addEventListener("load",()=>O.guest().then(()=>{_.complete("config"),b.hasDataSrc()&&b.load(),Z.init(),Y.init(),Y.show().then(()=>_.complete("comment")).catch(()=>_.invalid("comment"))}).catch(()=>_.invalid("config")))}};return{init:()=>(J.init(),O.init(),O.isAdmin()&&(R("user").clear(),R("owns").clear(),R("likes").clear(),R("session").clear(),R("comment").clear(),R("tracker").clear()),window.addEventListener("DOMContentLoaded",o),{util:v,theme:J,comment:Y,guest:{open:p,modal:l,closeInformation:m}})}})();(r=>{r.undangan=ce.init()})(window);})();
